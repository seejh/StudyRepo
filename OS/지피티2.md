1. 히스토리
운영체제 강의를 보다가 FPS 게임하는데 싱글 스레드로 만들면 마우스, 키보드, 사운드 등의 입출력으로 인해
블로킹이 발생해서 컨텍스트 스위칭으로 인해 뚝뚝 끊긴하고 함.

마우스가 움직이는 동안 화면이 움직이지 않고 화면이 움직이는 동안 소리가 나오지 않고 이런식.

--------------------------------------------------------------------------------------------------------------------
2. 궁금해서 지피티한테 물어봄.
질문: 
운영체제를 학습하고 있는 도중 FPS 게임을 할 때 마우스 입출력, 화면 입출력, 스피커 입출력이 발생하면
각 입출력이 발생할 때 블로킹이 걸리고 컨텍스트 스위치가 발생하기 때문에 멀티스레드로 사용해야 한다고 하는데
싱글 스레드로 가능한거지?

답변:
마우스/화면/사운드 I/O 때문에 "필연적으로 Block + 컨텍스트 스위치가 발생해서 멀티스레드가 반드시 필요하다"는
말은 틀리다.

즉, 단일 스레드 게임 루프에서도 이벤트 기반 또는 논블로킹 I/O를 사용하면 Block이 발생하지 않는다.

- 마우스 입력
하드웨어 인터럽트 -> OS가 큐에 이벤트 전달
게임은 이벤트 큐에서 poll
블로킹 없음

- 화면 출력
CPU -> GPU에게 렌더링 명령 제출(논블로킹)
GPU 병렬로 작업
CPU는 계속 실행
블로킹없음

-사운드 출력
오디오 버퍼만 채워놓고 OS/드라이버가 재생
CPU 블록되지 않는다.
--------------------------------------------------------------------------------------------------------------------
3. 그래서 대충 논블로킹이라는 거 같은데 ...
질문:
마우스 입력 부분 "하드웨어 인터럽트 -> OS가 큐에 이벤트 전달"
이 부분이 CPu 개입이 없는 과정이냐?

답변:
아니 있다. 단, CPU가 게임 스레드처럼 사용자 모드에서 코드 실행을 하는 것은 아니고
인터럽트 컨텍스트(커널 모드)에서 매우 짧게 개입하는 형태.

과정을 상세히 표현하자면
1) 마우스에서 이벤트 발생
마우스 움직이거나 클릭하면 USB 또는 PS/2 컨트롤러가 interrupt signal을 cpu로 전달한다.

2) cpu는 인터럽트를 감지하고 커널로 진입
cpu는 현재 실행 중이던 사용자 프로그램을 잠시 멈추고
해당 장치의 interrupt handler(ISR)를 실행한다.

이 단계에서 CPU가 확실히 개입한다.

3) OS의 마우스 드라이버 ISR 실행
USB HID 드라이버가 마우스 패킷을 읽는다.
간단한 전처리 수행
이벤트를 OS 내부 입력 서브시스템(evdev, HID, Windows Raw Input 등)에 전달

4) OS가 이벤트를 이벤트 큐에 push
이벤트 큐(ex: Windows 메시지 큐, )에 들어간다.

이 역시 CPU(커널 모드)가 수행한다.

--------------------------------------------------------------------------------------------------------------------
4. 윗 질문에서 CPU 개입이 있다며? 그러면 CPU에 코어가 하나라 가정하면 마우스 입출력을 위해 CPU가 잠시 
유저 모드에서 게임 처리를 멈추고 하드웨어 처리를 해야 하는 것 아닌가?

그래 맞아. 단일 코어에서 CPU가 잠시 게임을 멈추고 마우스 인터럽트를 처리한다.
하지만 그 잠시가 극도로 짧아서 게임 성능에 영향을 거의 주지 않는다.

그니까 이게 게임이 "블록되어 멈추는 게 아니라 게임 실행이 잠시 인터럽트 된다"라고 이해해야 한다.

단일 코어 CPU라 할 때 과정
1. 게임 루프 실행(유저 모드)
2. 마우스 이벤트 발생
하드웨어가 CPU 인터럽트 라인에 신호
3. CPu는 지금 실행 중인 게임 스레드를 잠시 멈추고 커널 모드의 인터럽트 처리 코드(ISR) 실행
4. ISR은 이벤트 몇 바이트르 ㄹ읽고 OS 이벤트 큐에 push
5. CPU는 다시 게임 루프로 복귀(유저 모드)

게임 코드가 잠깐 멈춘다 Ok, But 게임 스레드가 블록된다 X.
(커널이 처리하는 동안 Block 상태로 전환되는 것이 아님.)
--------------------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------------------



✅ 1. 단일 코어 CPU에서 인터럽트가 미치는 영향은 왜 작을까?

단일 코어라고 하더라도 컴퓨터는 인터럽트 기반 멀티태스킹 구조 때문에
입·출력 이벤트를 처리하면서 동시에 게임을 실행할 수 있다.

이 때 핵심은 다음 두 가지다:

✔ (1) 인터럽트는 매우 짧다 (수 μs 수준)

USB 마우스 기술적 수치 기준:

USB 1000Hz polling → 1ms에 1번 이벤트

ISR(Interrupt Service Routine) 실행 시간 → 약 2~10μs

CPU에서 1ms 동안 수행 가능한 시간 → 1,000μs

인터럽트가 차지하는 비율 → 약 0.2~1%

즉 CPU가 99% 이상을 여전히 게임에 사용할 수 있다.



--------------------------------------------------------------------------------------------------------------------











