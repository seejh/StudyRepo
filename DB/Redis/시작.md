# 시작하기 전에
현업에서 굉장히 많이 사용하고 있는 기술 중 하나.
캐싱, 세션 관리, 메시지 큐, 실시간 통계 등 활용 용도가 너무 다양해서 학습하기가 힘들다.
그래서 이 Redis를 학습할 때는 개념을 전부 익히고 실습을 하는 것이 아니라 최소한의 개념만, 조회 성능 개선하는 사례로
학습하고 Redis에 어느정도 익숙해진 뒤 다른 개념들을 학습하는 식으로 한다.

# Redis
데이터 처리 속도가 빠른 NoSQL 데이터베이스이다. <br/>
DB가 아닌 메모리에 저장하기에 데이터 처리속도가 빠른, NoSQL=> 키와 값의 형태로 저장하는, 데이터베이스이다.

# 주요 사용 사례
* 캐싱(Caching)
* 세션 관리(Session Management)
* 실시간 분석 및 통계(Real-time Analystics)
* 메세지 큐(Message Queue)
* 지리공간 인덱싱(Geospatial Indexing)
* 속도 제한(Rate Limiting)
* 실시간 채팅 및 메시징(Real-time Chat And Messaging)

레디스에 내장된 기능이 다양하다보니 여러 용도로 사용된다. 레디스를 처음 배우는 입장에서 이 모든 사례를 익히려고 하면 막막할 수 
밖에 없다. 따라서 현업에서 가장 많이 사용되는 캐싱(데이터 조회 성능 향상)만 살펴보고 레디스에 익숙해진 뒤 다른 것들도 살을 붙여
나갈 수 있게끔 한다.

# 채용 공고에서의 '대용량 트래픽 처리 경험', 'NoSQL'
백엔드 개발자 채용 공고를 살펴보면 대용량 트래픽에 관한 얘기와 NoSQL에 관한 얘기가 자주 나온다. 이 역량이
서비스가 점점 고도화 될 수록 빼놓을 수 없는 역량이기 때문이다. 이 2가지 역량을 채울 수 있는 방법 중 하나가 Redis이다. <br/>

대용량 트래픽을 처리하기 위해서 필수적으로 사용되는 기능이 Redis의 캐싱(Caching) 기능이다. 또한 Redis는 NoSQL의 일종이다.
따라서 Redis를 학습함으로써 최근 회사에서 요구하는 자격 요건을 맞출 수 있도록 노력해보자.

# 기본 명령어 익히기
대부분 Redis 강의나 책을 보면 알겠지만 자료 구조(string, list, hash, Set, sorted set 등)를 설명하고 수없이 많은
명령어(SET, GET, EXISTS, DEL, HSET 등)를 설명하고 있다. 하지만 레디스를 익히려면 저기 있는 모든 개념을 다 익힌 뒤에
실습을 하면 늦다. 머릿 속에 한 가지 개념만 들어와도 벅찬데 수십개의 개념을 머리에 넣으려고 하다보니, 막상 실습 때 아무것도
기억나지 않는 것이다. <br/>

따라서 딱 필요한 개념만 배우고 바로 실습을 통해 레디스를 사용해본다. 이 강의에서는 딱 7가지의 명령어만 배울 것이다.
레디스의 조회 성능을 개선할 때는 이 7가지 명령어만 알아도 충분하다. 그러다 레디스를 쓰면서 추가적으로 필요한 기능이 있으면
그때그때 찾아서 사용하면 된다.

## 아래는 레디스 클라이언트에서 입력하는 명령
## 데이터(Key, Value) 저장하기
```
// 띄워쓰기가 있는 value
set jaeseong:name "jaeseong park"
// 띄워쓰기가 없는 value
set jaeseong:hobby soccer
```
## 데이터 조회
```
get jaeseong:name
"jaeseong park"
get jaeseong:hobby
"soccer"

// 모든 key 조회
// 라이브되고 있는 환경에서는 치면 안된다고 알고 있음
keys *
1) "jaeseong:name"
2) "jaeseong:hobby"
```
## 데이터 삭제
```
// return이 1이면 정상적 삭제
del jaeseong:hobby
(integer) 1

// 없는 데이터를 삭제하려고 하는 경우
del jaeseong:hobby
(nil)
```
## 데이터 저장 시 만료 시간 설정(TTL, Time To Live)
레디스는 RDBMS와는 다르게 데이터 저장 시 만료시간을 설정할 수 있다. 즉, 영구적으로 데이터를 저장하지 않고
일정 시가이 되면 데이터가 삭제되도록 세팅할 수 있다. <br/>

레디스의 특성상 메모리 공간이 한정되어 있기 때문에 모든 데이터를 레디스에 저장할 수 없다. 따라서 만료시간을
활용해 자주 사용하는 데이터만 레디스에 저장해놓고 쓰는 식으로 활용한다.
```
// set 키 값 ex 만료 시간(초)
set jaeseong:pet dog ex 30
```
## 만료 시간 조회
```
ttl jaeseong:pet
(integer) 4
ttl jaeseong:pet
(integer) 1
ttl jaeseong:pet
(integer) 0
// 키가 없는 경우 -2를 반환 (만료 되어서 없음)
ttl jaeseong:pet
(integer) -2
// 만료 시간이 설정되어 있지 않은 경우 -1 반환
ttl jaeseong:name
(integer) -1
```
## 데이터 전부 제거
```
flushall
(empty array)
```

# 레디스에서의 key 네이밍 컨벤션
현업에서 자주 사용하는 key 네이밍 컨벤션, 예시를 통해 이해해보자. <br/>
```
// 사용자들(users) 중에서 PK가 100인 사용자의 프로필
users:100:profile

// 상품들 중에서 PK가 123인 상품의 세부사항
products:123:details
```
콜론(:)을 활용해 계층적으로 의미를 구분해서 사용한다. <br/>
이런 식으로 컨벤션을 정했을 때 장점은 아래와 같다. <br/>
1) 가독성
   데이터의 의미와 용도를 쉽게 파악할 수 있다.
2) 일관성
   컨벤션을 따름으로써 코드의 일과성이 높아지고 유지보수가 쉬워진다.
3) 검색 및 필터링 용이성
   패턴 매칭을 사용해 특정 유형의 key를 쉽게 찾을 수 있다.
4) 확장성
   서로 다른 key와 이름이 겹쳐 충돌할 일이 적어진다.

# 캐시(Cache), 캐싱(Caching)이란
캐시란, 원본 저장소보다 빠르게 가져올 수 있는 임시 데이터 저장소를 의미한다 <br/>
캐시라는 단어는 redis에서만 쓰이는 용어는 아니고 전반적인 개발 분야에서 통용되어 쓰인다.
<img src="https://github.com/user-attachments/assets/891d541f-6bc1-4147-bcda-95efa4a4063b" width="400" height="300" />

캐싱이란, 캐시(임시 데이터 저장소)에 접근해서 데이터를 빠르게 가져오는 방식을 의미한다. <br/>
현업에서는 아래와 같이 얘기하는 편이다. <br/>
"이 API는 응답 속도가 너무 느린데? 이 응답 데이터는 캐싱해두고 쓰는 게 어때?" <br/>
이 말을 풀어서 설명하자면 API 응답 결과를 원본 저장소보다 빠르게 가져올 수 있는 임시 데이터 저장소에 저장해두고, 빠르게 조회할
수 있게 만들자는 의미이다.

# 데이터를 캐싱할 때 사용하는 전략(Cache Aside, Write Around)
레디스를 캐시로 쓸 때 어떤 방식으로 사용할 지 전략이 다양하다. 처음에는 그 중에서 딱 2가지의 전략만 배워도 충분하다.
이 전략이 현업에서 가장 많이 사용되고 있는 전략이다. 나머지의 전략들은 이 2가지 전략이 익숙해진 뒤에 차근차근 추가로 학습하면 된다.
## Cache Aside(=Look Aside, Lazy Loading) 전략
데이터를 조회할 때 주로 사용하는 전략 <br/>
캐시에서 데이터를 조회하고 없다면 DB를 통해 조회해오는 방식
### 캐시에 데이터가 있을 경우(=Cache Hit)
<img src="https://github.com/user-attachments/assets/f52f8696-35ab-46ed-b7aa-47b807db7dbd" width="400" height="300" />

### 캐시에 데이터가 없을 경우(=Cache Miss)
<img src="https://github.com/user-attachments/assets/abfd386f-4f2f-4f1e-afe5-c6105b4a44cf" width="400" height="300" />

### 작동 방식
처음으로 게시판 서비스를 배포했다고 가정하고 Cache Aside 방식을 이해해보자. <br/>
1. 처음 게시판 서비스를 배포했기 때문에 DB와 레디스에 아무런 데이터도 저장되어 있지 않은 상태
2. 일부 사용자가 들어와 게시글을 작성하고 저장한다. 이 데이터는 DB에 저장된다. (레디스에는 저장되어 있지 않은 상태)
3. 사용자가 데이터 조회 요청, 이 때, 레디스에 먼저 확인한다.
4. 레디스에 데이터가 없는 걸 확인한 뒤 DB로 조회하여 응답한다.
5. DB에서 조회한 데이터를 응답한 후 레디스에도 데이터를 저장해둔다.
6. 다시 한 번 사용자가 데이터를 조회하려고 요청한다.
7. 레디스에 조회하고자 하는 데이터가 있는 지 확인했더니 데이터가 존재해서 레디스로부터 데이터를 바로 가져온다.
정리하면 데이터를 조회할 때 먼저 캐시부터 조회를 한다는 것이고 여기서 캐시에 데이터가 있으면(캐시 히트) 3번에서 끝나고
캐시에 조회하는 데이터가 없다면 3, 4, 5의 과정을 거친다는 것이다.

## Write Around 전략
데이터를 어떻게 쓸 지(저장, 수정, 삭제)에 대한 전략 <br/>
Write Around 전략은 Cache Aside 전략과 같이 자주 활용되는 전략이다. <br/>
쓰기 작업(저장, 수정, 삭제) 시에 캐시에는 반영하지 않고 DB에만 반영하는 방식을 뜻한다. <br/>
![image](https://github.com/user-attachments/assets/47123456-eba6-4e33-96d9-a3505e8626b1)
Write Around 전략은 생각보다 너무 간단하다. 데이터를 저장할 때는 레디스에 저장하지 않고 DB에만 저장하는 방식이다.
그러다 데이터를 조회할 때 레디스에 데이터가 없으면 DB로부터 데이터를 조회해와서 레디스에 저장시켜주는 방식이다.

# Cache Aside, Write Around 전략의 한계와 해결법
## 한계 1. 캐시된 데이터와 DB 데이터가 일치하지 않을 수 있다.

## 한계 2. 캐시에 저장할 수 있는 공간이 비교적 작다.
DB는 디스크(Disk)에 저장해서 많은 양을 저장하기 용이하지만, 캐시는 메모리(RAM)에 저장하기 때문에
DB에 비해 많은 양의 데이터를 저장할 수가 없다.

## 해결법
### 캐시된 데이터와 DB 데이터가 일치하지 않을 수 있다.
캐시와 DB의 데이터를 일치시키기 위해, 데이터를 수정할 때마다 동시에 업데이트 시키면 

출처 : <br/>
https://www.youtube.com/watch?v=IgVg6GhzFk8&list=PLtUgHNmvcs6qoVrxB5jzZ4meINz_KL-Bl <br/>

<hr/><br/><br/>
