# Sqlite 튜토리얼

## Sqlite?
MySQL 또는 PostgreSQL과 같은 일반적인 RDBMS는 별도의 서버 프로세스를 실행해야 한다. <br/>
그 후 애플리케이션에서 TCP/IP 프로토콜을 사용하여 요청을 보내고 받는다. <br/>
![image](https://github.com/user-attachments/assets/ef33c0b4-2076-4ee9-bb39-1dbadbcad7e8) <br/><br/>
Sqlite는 애플리케이션에 통합되어 애플리케이션에서 직접 데이터베이스 파일에 접근해서 사용한다. <br/>
![image](https://github.com/user-attachments/assets/f7341c65-91a2-418c-b39c-2386418fa5b7) <br/>
주로 사용하는 환경 : 로컬 저장소가 필요한 환경, 개발 또는 테스트 시에 사용 <br/>


## C++에서 Sqlite 사용
### 기본적인 사용법
```c++
int callback(void*, int, char**, char**);

int main() {
  //
  sqlite3* dbConn;
  int result;
  string query;
  char* errMsg;

  /*-------------------------------------------------------
    DB 오픈
  -------------------------------------------------------*/
  result = sqlite3_open("filename.db", &dbConn);
  if (result != SQLITE_OK) {
    cerr << "DB OPEN FAILED, CAUSE:" << sqlite3_errmsg(dbConn) << endl;
    return 0;
  }
  cout << "DB OPEN OK" << endl;

  /*-------------------------------------------------------
    테이블 생성
  -------------------------------------------------------*/
  query = "CREATE TABLE STUDENT("
    "ID INT PRIMARY KEY NOT NULL,"
    "NAME TEXT NOT NULL,"
    "EMAIL TEXT NOT NULL);";
  result = sqlite3_exec(dbConn, query.c_str(), NULL, 0, &errMsg);
  if (result != SQLITE_OK) {
    // 테이블 생성 실패 - 에러 메시지 출력, 에러 메시지 할당 해제, DB 연결 해제, 프로그램 종료
    cerr << "CREATE TABLE FAILED, CAUSE:" << errMsg << endl;
    sqlite3_free(errMsg);
    sqlite3_close(dbConn);
    return 0;
  }
  cout << "CREATE TABLE OK" << endl;

  /*-------------------------------------------------------
    데이터 삽입
  -------------------------------------------------------*/
  query = "INSERT INTO STUDENT (ID, NAME, EMAIL) VALUES"
    "(1, 'Jonh', 'john@email.com'),"
    "(2, 'Peter', 'peter@email.com'),"
    "(3, 'Homer', 'homer@email.com');";
  result = sqlite3_exec(dbConn, query.c_str(), NULL, 0, &errMsg);
  if (result != SQLITE_OK) {
    cerr << "INSERT FAILED, CAUSE:" << errMsg << endl;
    sqlite3_free(errMsg);
    sqlite3_close(dbConn);
    return 0;
  }
  cout << "INSERT OK" << endl;

  /*-------------------------------------------------------
    데이터 삭제
  -------------------------------------------------------*/
  query = "DELETE FROM STUDENT WHERE ID = 2;";
  result = sqlite3_exec(dbConn, query.c_str(), NULL, 0, &errMsg);
  if (result != SQLITE_OK) {
    cerr << "DELETE FAILED, CAUSE:" << errMsg << endl;
    sqlite3_free(errMsg);
    sqlite3_close(dbConn);
    return 0;
  }
  cout << "DELETE OK" << endl;

  /*-------------------------------------------------------
    업데이트
  -------------------------------------------------------*/
  query = "UPDATE STUDENT SET EMAIL = 'homerhomer@email.com' WHERE ID = 3;";
  result = sqlite3_exec(dbConn, query.c_str(), NULL, 0, &errmsg);
  if (result != SQLITE_OK) {
    cerr << "UPDATE FAILED, CAUSE:" << errMsg << endl;
    sqlite3_free(errMsg);
    sqlite3_close(dbConn);
    return 0;
  }
  cout << "UPDATE OK" << endl;

  /*-------------------------------------------------------
    데이터 검색    
  -------------------------------------------------------*/
  query = "SELECT * FROM STUDENT;";
  result = sqlite3_exec(dbConn, query.c_str(), callback, 0, &errMsg);
  if (result != SQLITE_OK) {
    cerr << "SELECT FAILED, CAUSE:" << errMsg << endl;
    sqlite3_free(errMsg);
    sqlite3_close(dbConn);
    return 0;
  }
  cout << "SELECT OK" << endl;
  
}

// 데이터 검색(SELECT)에서 사용할 콜백함수 정의
int callback(void* data, int count, char** argv, char** columnNames) {
  for (int i = 0; i < count; i++)
    cout << "Col : " << columnNames[i] << " = " << argv[i] << endl;

  return 0;
}
```


### 성능 고려
1) sqlite3_exec()는 내부적으로 2) sqlite3_prepare(), sqlite3_step(), sqlite3_finalize()로 구성되어 있다. <br/>
sqlite3_prepare로 사용할 때마다 컴파일하기 때문에 한 번 만들어놓고 계속 사용한다면 1안(sqlite3_exec)을 사용하기 보다
2안을 사용하는 것이 좋다. 그 외에도 성능 향상을 위한 방법은 많고 아래 링크에서 성능 향상 링크를 참고하는 것이 좋다.
```c++
int main() {
  
}
```

### 함수 설명
자세한 내용은 공식에서 매뉴얼을 보는 것이 좋다. <br/>



사용할 때마다 컴파일하기 때문에 그냥 prepared로 사용하는게 컴파일 안하고 성능향상이란말

출처 : <br/>
https://izen8.tistory.com/289 <br/>
https://medium.com/@duthujoe/sqlite-c-a-beginners-guide-243beb3fb3de <br/>
https://mangsby.com/blog/programming/sqlite-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EB%A5%BC-10%EB%B0%B0-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%B0%A9%EB%B2%95/ - sqlite 성능 향상 <br/>
<hr/><br/><br/>
