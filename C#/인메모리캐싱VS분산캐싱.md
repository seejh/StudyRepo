# ASP.NET Core 에서 인메모리 캐싱(In-Memory)과 분산 캐싱(Distributed)의 차이점
DB와 같이 느린 데이터 소스에서 반복적으로 가져오는 대신 자주 액세스 하는 데이터를 캐시(메모리)에 저장하여<br/> 
앱의 성능을 향상시키기 위한 기본적인 캐싱 방법으로 ASP.NET Core 앱 내 메모리(인 메모리)를 사용하는 방법과 <br/>
앱 외 메모리(ASP.NET과 별개의 프로그램, ex. 레디스 등)를 사용하는 방법에 대한 차이점에 대한 분석 <br/>

# ASP.NET Core에서의 인메모리 캐싱
실행중인 웹앱의 메모리에 캐싱하는 것을 말한다. <br/>
외부 호출 없이 앱에서 직접 액세스할 수 있으므로 매우 빠르다. <br/>
![image](https://github.com/user-attachments/assets/e0ca385c-b059-4c2e-82e0-757be65da57c)

# 인메모리 캐싱 설정 및 구성
캐시 공급자가 기본적으로 ASP.NET에 내장되어 있으므로 쉽게 구성할 수 있고 IMemoryCache를 사용하여 캐시를 사용한다. <br/
## 인메모리 캐싱 장점
속도 - 웹앱의 메모리를 사용하기에 액세스 시간이 매우 빠르다. <br/>
편의성 - ASP.NET Core에 내장되어 있는 내용으로 설정과 사용이 편한다 <br/>
## 인메모리 캐싱 단점
확장성 - 데이터는 앱이 실행 중인 서버의 메모리에 저장되기 때문에 분산 캐싱과 달리 클라우드 환경에서 자동으로 확장되지 않는다. <br/>
가용성 - 저장공간이 따로 있는 분산 방식과 달리 앱이 다시 시작되는 경우 데이터가 손실되며 사용 불가 <br/>
## 인메모리 캐싱 사용 사례
캐시 무효화가 문제가 되지 않고, 편의성이 우선인 소규모 또는 단일 서버 프로그램(ex. 테스트용) <br/>
속도(성능)이 가장 중요한 요소인 경우 <br/>

## 인메모리 캐싱 사용
ASP.NET Core의 DI 컨테이너는 캐시된 항목을 설정하고 검색할 수 있는 IMemoryCache 인스턴스 제공 <br/>
### 캐시 액세스
생성자 주입을 통해 컨트롤러 또는 서비스에서 캐시로 액세스 할 수 있다. <br/>
### 데이터 저장
데이터와 키를 제공하여 저장, 필요에 따라 만료 시간과 같은 캐시 옵션 설정 가능 <br/>
Set, CreateEntry 또는 확장 메서드인 GetOrCreate(찾는 데이터가 없으면 만드는 함수) 메서드 사용 <br/>
### 데이터 검색
Get 메서드를 사용하여 키에 해당하는 데이터 검색, 해당하는 항목이 없으면 null을 리턴 <br/>
### 옵션
#### Absolute Expiration(절대 만료)
캐시된 데이터가 만료되는 시간을 설정 <br/>
#### Sliding Expiration(슬라이딩 만료)
절대 만료의 개념에서 만료 시간 전에 데이터가 액세스되는 경우, 만료 시간을 연장하는 개념 <br/>
#### Priority (우선권)
메모리 압력(Memory Pressure)으로 인해 정리가 발생하는 과정에서 데이터 유지 우선권을 명시하는 것 <br/>
자세한 내용은 따로 검색하여 학습 <br/>

<hr/></br><br/>

# ASP.NET Core에서의 분산 캐싱
일반적으로 여러 서버 또는 인스턴스에서 공유되는 캐시로서 ASP.NET 내부 메모리가 아니라 외부에 따로 캐시가 존재하는 형태 <br/>
![image](https://github.com/user-attachments/assets/b634d43b-12e5-4c3a-bab1-ecdc5b51cfef)
# 분산 캐싱 설정 및 구성
## 분산 캐시 공급자
ASP.NET Core는 Redis, SQL Server 및 NCache를 포함한 여러 분산 캐시 공급자를 지원한다. <br/>
Redis는 성능과 기능으로 인해 인기있는 선택이다. <br/>

## 사용
IDistributedCache 인스턴스를 사용하여 캐시를 사용한다. <br/>
### 데이터 저장 
SetAsync(비동기), Set(동기) 메서드를 사용하여 키와 데이터를 저장 <br/>
### 데이터 검색
GetAsync, Get을 사용하여 검색 <br/>
### 만료 및 제거
직접 명령으로 제거하거나 만료 시간을 옵션으로 설정하여 자동으로 제거할 수 있다. <br/>

## 캐시 무효화(데이터 불일치)에 대한 고려 사항
### 데이터 불일치
### 일관성
캐시와 DB에서 일관성을 보장하는 것은 특히 처리량이 많은 환경에서 어려울 수 있다. <br/>
write-through 또는 write-begind 캐싱과 같은 캐시 전략을 사용하여 이러한 문제를 해결할 수 있다. <br/>

## 분산 캐싱 장점
확장성 - 캐시가 웹앱(ASP.NET Core)와 독립적으로 관리됨으로 더 많은 캐시를 추가하여 쉽게 확장 가능 <br/>
가용도 - 웹앱이 재시작하더라도 캐시는 유지 <br/>
성능 향상 - 분산 캐싱 방법의 장점이라기 보다는 캐싱의 장점 <br/>
DB 왕복 횟수를 줄이고 캐시에서 데이터를 제공함으로써 응답 시간을 크게 줄일 수 있다. <br/>
## 분산 캐싱 단점
복잡성 - 구현과 관리에 대한 웹앱의 아키텍처가 복잡해진다. <br/>
비용 - 솔루션에 따라 캐시 인프라 호스팅 및 관리와 관련된 추가 비용이 있을 수 있다. <br/>
## 분산 캐싱 사용 사례
고가용성 및 확장성이 필요한 대규모 분산 응용 프로그램 <br/>
서버를 재기동하는 등 서버 메모리가 소실되는 상황에서도 캐시 데이터를 지속할 필요가 있는 앱 <br/>

<br/><br/>
출처 : <br/>
https://dotnettutorials.net/lesson/difference-between-in-memory-caching-and-distributed-caching-in-asp-netcore/ <br/>

<hr/>

# 캐시 전략
앱의 성능 최적화와 사용자 경험 개선을 위해 캐시는 필수 요소로 자리 잡았다. <br/>
캐시는 DB 보다 더 빠른 접근성을 제공하여 성능을 향상시키지만, 사용 목적과 데이터 특성에 따라 적합한 캐시 전략을 선택하는 것이 중요하다. <br/>
대표적인 캐시 전략 세 가지(Cache Aside, Write Through, Write Behind)를 알아보자. <br/>

## Cache Aside
데이터 조회 시 캐시를 먼저 확인하고, 캐시에 데이터가 없을 경우 DB에서 가져오는 방식 <br/>
가져온 데이터는 캐시에 저장되어 이후 요청 시 빠르게 반환된다. <br/>
### 동작 흐름
요청이 들어오면 캐시를 확인한다. <br/>
캐시에 데이터가 없으면 DB에서 조회한다. <br/>
조회된 데이터를 캐시에 저장한다. <br/>
캐시에 저장된 데이터를 반환한다. <br/>

## Write Through
데이터 저장 요청 시 캐시와 DB에 동시에 데이터를 기록하는 방식이다. <br/>
이 방식은 캐시에 항상 최신 데이터를 유지할 수 있도록 설계 되어있다. <br/>
### 동작 흐름
데이터 저장 요청 시 캐시와 DB에 저장한다. <br/>
이후 데이터 조회 요청 시 항상 최신 데이터가 캐시에 존재한다. <br/>

### 장점
캐시와 DB 간 데이터 일관성이 유지된다. <br/>
데이터 조회 시 항상 최신 데이터를 제공한다. <br/>
### 단점
#### 저장 시에 딜레이
캐시와 DB에 데이터를 동시에 기록하므로 저장 작업이 느리다. <br/>
#### 메모리 낭비
자주 사용되지 않는 데이터도 캐시에 저장되기 때문에 캐시 메모리를 비효율적으로 사용할 수 있다. <br/>

## Write Behind
데이터 저장 요청 시 캐시에만 기록, 일정 시간 간격으로 캐시의 데이터를 DB에 기록하는 방식 (Batch 작업) <br/>

### 동작 흐름
데이터 저장 요청 시 캐시에 데이터를 기록한다. <br/>
일정 시간 간격을 두고 주기적으로 캐시의 데이터를 DB에 기록한다. <br/>
데이터 조회 요청 시, 캐시에 저장된 데이터를 바로 반환한다. <br/>

### 장점
저장 작업이 비동기로 처리됨으로 응답 속도가 빠르다. <br/>
데이터 저장 요청이 많을 경우, DB 부하를 줄이고 성능을 최적화할 수 있다. <br/>

### 단점
#### 데이터 손실
캐시에 기록된 데이터가 주기적으로 DB에 저장되기 때문에 저장 주기 전에 캐시가 삭제되거나 장애가 발생하면 데이터 손실 가능성이 있다. <br/>
#### 일관성
DB와 캐시 간 일관성 문제가 발생할 수 있다. <br/>

# 캐시 전략 선택 시에 고려 항목
데이터 조회와 저장의 빈도 차이 (캐시의 주목적이 읽기 성능 최적화 or 쓰기 성능 최적화) <br/>
데이터의 실시간성이 중요한가 <br/>
캐시와 DB 간 일관성이 중요한가 <br/>

## 추가 내용
캐시는 앱의 성능 개선에 매우 중요한 역할을 하지만, 무작정 사용하는 것은 피해야 한다. <br/>
데이터 특성, 시스템 요구사항, 업무 로직에 따라 적합한 캐시 전략을 선택하고 설계하는 것이 중요하다. <br/>
위에서 살펴본 전략을 단일로 사용하거나 조합하여 사용할 수 있다. <br/>

출처 : <br/>
https://velog.io/@yoseb95/%EC%BA%90%EC%8B%9C-%EC%A0%84%EB%9E%B5%EC%9D%98-%EC%9D%B4%ED%95%B4-Cache-Aside-Write-Through-Write-Behind <br/>
<hr/>
